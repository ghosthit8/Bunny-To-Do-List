<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hand-in-Hand To-Do ‚ô•</title>

  <!-- Pixel-y fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#06070a;
      --bg1:#0b0d13;
      --panel:rgba(10,12,18,.78);
      --fg:#e9fff4;
      --muted:#9fd8bb;
      --neon:#39ff88;
      --pink:#ff6fa9;
      --rose:#ff9bc4;
      --border:#24322b;
      --shadow: rgba(0,0,0,.65);
      --r:18px;
      --pixel: 2px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      color:var(--fg);
      font-family:"VT323", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:20px;
      letter-spacing:.2px;
      background:
        radial-gradient(1200px 900px at 50% -10%, rgba(255,111,169,.12), transparent 60%),
        radial-gradient(900px 700px at 10% 30%, rgba(57,255,136,.10), transparent 65%),
        radial-gradient(900px 700px at 90% 60%, rgba(255,155,196,.08), transparent 70%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      min-height:100vh;
      overflow-x:hidden;
      position:relative;
    }

    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(1200px 900px at 50% 40%, transparent 45%, rgba(0,0,0,.55) 90%),
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.55;
      z-index:1;
    }

    body::after{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.03) 0px,
        rgba(255,255,255,.03) 1px,
        rgba(0,0,0,0) 2px,
        rgba(0,0,0,0) 6px
      );
      opacity:.25;
      z-index:2;
    }

    .wrap{max-width:980px;margin:0 auto; position:relative; z-index:3;}

    header{
      position:sticky; top:0; z-index:10;
      padding:14px 14px 10px;
      background: linear-gradient(180deg, rgba(6,7,10,.92), rgba(6,7,10,.70));
      backdrop-filter: blur(10px);
      border-bottom: var(--pixel) solid rgba(57,255,136,.18);
    }

    .titleRow{
      display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end; justify-content:space-between;
    }

    h1{
      margin:0;
      font-family:"Press Start 2P", system-ui;
      font-size:14px;
      line-height:1.2;
      letter-spacing:1px;
      text-shadow: 0 2px 0 rgba(0,0,0,.55);
      display:flex; gap:10px; align-items:center;
    }
    .heartBadge{
      display:inline-flex; align-items:center; justify-content:center;
      width:28px; height:28px;
      border: var(--pixel) solid rgba(255,111,169,.55);
      border-radius:8px;
      background: rgba(255,111,169,.10);
      box-shadow: 0 8px 22px rgba(255,111,169,.12);
      transform: translateY(-1px);
    }
    .heartBadge span{color:var(--pink); font-size:16px;}

    .sub{
      margin-top:8px;
      color:rgba(233,255,244,.75);
      font-size:18px;
      text-shadow: 0 1px 0 rgba(0,0,0,.55);
    }
    .sub em{color:rgba(255,155,196,.85); font-style:normal;}
    .sub b{color:rgba(57,255,136,.9); font-weight:700;}

    .btnRow{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{
      border: var(--pixel) solid rgba(36,50,43,.9);
      background: linear-gradient(180deg, rgba(14,18,26,.85), rgba(8,10,15,.80));
      color:var(--fg);
      border-radius:14px;
      padding:10px 14px;
      font-size:18px;
      cursor:pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.45);
      position:relative;
      overflow:hidden;
    }
    .btn::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.10), transparent);
      transform: translateX(-120%);
      transition: transform .35s ease;
      pointer-events:none;
    }
    .btn:hover::after{transform: translateX(120%);}
    .btn.primary{
      border-color: rgba(57,255,136,.55);
      box-shadow: 0 12px 26px rgba(57,255,136,.08), 0 10px 24px rgba(0,0,0,.45);
    }
    .btn.danger{
      border-color: rgba(255,111,169,.55);
      box-shadow: 0 12px 26px rgba(255,111,169,.10), 0 10px 24px rgba(0,0,0,.45);
    }

    main{padding:16px 14px 44px; position:relative; z-index:3;}

    .card{
      background: var(--panel);
      border: var(--pixel) solid rgba(36,50,43,.85);
      border-radius: var(--r);
      overflow:hidden;
      box-shadow: 0 22px 60px rgba(0,0,0,.55);
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 14px 14px, rgba(255,111,169,.22), transparent 55%),
        radial-gradient(circle at calc(100% - 14px) 14px, rgba(57,255,136,.14), transparent 55%),
        radial-gradient(circle at 14px calc(100% - 14px), rgba(57,255,136,.10), transparent 55%),
        radial-gradient(circle at calc(100% - 14px) calc(100% - 14px), rgba(255,155,196,.18), transparent 55%);
      opacity:.55;
      z-index:0;
    }

    .head{
      position:relative; z-index:1;
      padding:12px 12px;
      border-bottom: var(--pixel) solid rgba(36,50,43,.75);
      color:rgba(233,255,244,.78);
      font-size:18px;
      display:grid;
      grid-template-columns: 132px 1fr 200px;
      gap:12px;
      align-items:center;
      text-transform:lowercase;
    }
    .head div:last-child{text-align:right}

    .list{display:flex;flex-direction:column; position:relative; z-index:1;}

    .row{
      display:grid;
      grid-template-columns: 132px 1fr 200px;
      gap:12px;
      padding:12px 12px;
      align-items:center;
      border-bottom: 1px solid rgba(36,50,43,.55);
      cursor:pointer;
      user-select:none;
      position:relative;
      background:
        linear-gradient(180deg, rgba(255,111,169,.03), transparent 55%),
        linear-gradient(90deg, rgba(57,255,136,.03), transparent 60%);
    }
    .row:last-child{border-bottom:none}

    .dayInput{
      width:100%;
      border: var(--pixel) solid rgba(36,50,43,.55);
      outline:none;
      background: rgba(8,10,15,.55);
      color:rgba(159,216,187,.95);
      font-family:"Press Start 2P", system-ui;
      font-size:11px;
      padding:12px 10px;
      border-radius:14px;
      box-shadow: inset 0 0 0 1px rgba(255,111,169,.08);
      letter-spacing:1px;
    }
    .dayInput::placeholder{color:rgba(233,255,244,.35)}

    /* FIX: task boxes now wide + actually usable (textarea + autosize) */
    .task{
      width:100%;
      display:block;
      min-width:0;
      border: var(--pixel) solid rgba(36,50,43,.55);
      outline:none;
      background: rgba(8,10,15,.55);
      color:var(--fg);
      font-family:"VT323", monospace;
      font-size:30px;
      padding:16px 14px;
      border-radius:14px;
      box-shadow: inset 0 0 0 1px rgba(255,111,169,.08);
      line-height:1.05;
      resize:none;
      overflow:hidden;
    }
    .task::placeholder{color:rgba(233,255,244,.42)}

    .done .task, .done .dayInput{
      opacity:.60;
      text-decoration: line-through;
      text-decoration-thickness: 3px;
      text-decoration-color: rgba(255,111,169,.55);
      filter:saturate(.85);
    }

    .marker{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      pointer-events:auto;
      transform-origin: 50% 100%;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.65));
    }
    .marker.idle{ animation: idleBob 1.6s ease-in-out infinite; }
    @keyframes idleBob{
      0%,100%{transform:translateY(0)}
      50%{transform:translateY(-3px)}
    }

    canvas.couple{
      width:182px;
      height:124px;
      image-rendering: pixelated;
      background: transparent;
      border: none;
      display:block;
    }

    .footer{
      position:relative; z-index:1;
      padding:12px 12px;
      border-top: var(--pixel) solid rgba(36,50,43,.55);
      display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between;
      color:rgba(233,255,244,.62);
      font-size:18px;
    }

    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:4;
      opacity:.45;
    }
    .hearts i{
      position:absolute;
      width:10px; height:10px;
      background:
        radial-gradient(circle at 30% 35%, rgba(255,255,255,.65), transparent 35%),
        linear-gradient(180deg, rgba(255,111,169,.95), rgba(255,155,196,.75));
      transform: rotate(45deg);
      border-radius:2px;
      box-shadow: 0 10px 18px rgba(255,111,169,.15);
      animation: floaty linear infinite;
    }
    .hearts i::before,
    .hearts i::after{
      content:"";
      position:absolute;
      width:10px; height:10px;
      border-radius:50%;
      background: inherit;
      top:-5px; left:0;
    }
    .hearts i::after{left:-5px; top:0;}
    @keyframes floaty{
      0%{ transform: translate3d(0, 110vh, 0) rotate(45deg); opacity:0; }
      10%{opacity:.9}
      100%{ transform: translate3d(0, -20vh, 0) rotate(45deg); opacity:0; }
    }

    @media (max-width:560px){
      .head, .row{grid-template-columns: 120px 1fr 200px}
      canvas.couple{width:170px;height:118px}
      .dayInput{font-size:10px}
      .task{font-size:28px}
    }
  </style>
</head>
<body>

  <div class="hearts" aria-hidden="true">
    <i style="left:8%;  animation-duration:9.5s; animation-delay:-2s;  opacity:.35; transform:scale(1.2) rotate(45deg)"></i>
    <i style="left:18%; animation-duration:12s;  animation-delay:-7s;  opacity:.25; transform:scale(.9) rotate(45deg)"></i>
    <i style="left:33%; animation-duration:10.5s; animation-delay:-5s;  opacity:.32; transform:scale(1.0) rotate(45deg)"></i>
    <i style="left:48%; animation-duration:13s;  animation-delay:-9s;  opacity:.22; transform:scale(.8) rotate(45deg)"></i>
    <i style="left:62%; animation-duration:11s;  animation-delay:-4s;  opacity:.30; transform:scale(1.1) rotate(45deg)"></i>
    <i style="left:76%; animation-duration:9.8s; animation-delay:-6s;  opacity:.26; transform:scale(.95) rotate(45deg)"></i>
    <i style="left:90%; animation-duration:12.6s; animation-delay:-3s;  opacity:.28; transform:scale(1.05) rotate(45deg)"></i>
  </div>

  <header>
    <div class="wrap">
      <div class="titleRow">
        <div>
          <h1>
            <span class="heartBadge"><span>‚ô•</span></span>
            Hand-in-Hand To-Do
            <span style="color:var(--neon)">üíö</span>
          </h1>
          <div class="sub">
            Tap the <b>next day</b> to advance ‚Üí previous day crosses out ‚Üí <em>we walk down</em>.
          </div>
        </div>
        <div class="btnRow">
          <button class="btn primary" id="addRow">+ Row</button>
          <button class="btn danger" id="reset">Reset</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="card">
        <div class="head">
          <div>Day</div>
          <div>Task</div>
          <div>Us</div>
        </div>

        <div class="list" id="list"></div>

        <div class="footer">
          <div>Auto-saves on this device. ‚ô•</div>
          <div>Tip: tap a row to move us there. Tap the next day to ‚Äúcomplete‚Äù the current one.</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const KEY = "valentine_todo_advance_v1";
    const DAYS = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];

    const DEFAULT = {
      rows: [
        { day: "Mon", task: "Something sweet #1", done: false },
        { day: "Tue", task: "Something sweet #2", done: false },
        { day: "Wed", task: "Something sweet #3", done: false },
        { day: "Thu", task: "Something sweet #4", done: false },
        { day: "Fri", task: "Something sweet #5", done: false },
      ],
      markerRow: 0
    };

    // Boy now has GREEN eyes ‚úÖ
    const YOU = {
      outline:"#0a0d10",
      skin:"#e7c4a7",
      skinShade:"#d6ab8b",
      blush:"#ff8fb0",
      hair:"#1a1f26",
      hair2:"#0f1318",
      eye:"#39ff88",     // green
      eye2:"#1e8f55",    // darker green
      hoodie:"#0f151d",
      hoodie2:"#171f2a",
      hoodieShade:"#0a0f16",
      pants:"#0c1117",
      pants2:"#121a24",
      shoe:"#0a0d10",
      shoe2:"#121821",
      accent:"#39ff88"
    };

    const BUNNY = {
      outline:"#0a0d10",
      skin:"#e7c4a7",
      skinShade:"#d6ab8b",
      blush:"#ff8fb0",
      hair:"#7b3dff",
      hair2:"#4a26b8",
      eye:"#3b2a22",
      eye2:"#1f1410",
      hoodie:"#111017",
      hoodie2:"#1a1624",
      hoodieShade:"#0b0a10",
      pants:"#0e0e14",
      pants2:"#161625",
      shoe:"#0a0d10",
      shoe2:"#171726",
      glasses:"#d7e8ff"
    };

    let state = load();

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return structuredClone(DEFAULT);
        const data = JSON.parse(raw);
        if(!data || !Array.isArray(data.rows)) return structuredClone(DEFAULT);
        return data;
      }catch(e){ return structuredClone(DEFAULT); }
    }
    function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

    const list = document.getElementById("list");
    const addRowBtn = document.getElementById("addRow");
    const resetBtn = document.getElementById("reset");

    // ===== Pixel helpers =====
    function setupCanvas(canvas, W, H){
      canvas.width = W; canvas.height = H;
      const ctx = canvas.getContext("2d", { alpha: true });
      ctx.imageSmoothingEnabled = false;
      ctx.clearRect(0,0,W,H);
      return ctx;
    }
    function px(ctx, x, y, c){ ctx.fillStyle = c; ctx.fillRect(x,y,1,1); }
    function rect(ctx, x, y, w, h, c){ ctx.fillStyle = c; ctx.fillRect(x,y,w,h); }
    function outlineRect(ctx, x, y, w, h, c){
      for(let i=0;i<w;i++){ px(ctx, x+i, y, c); px(ctx, x+i, y+h-1, c); }
      for(let j=0;j<h;j++){ px(ctx, x, y+j, c); px(ctx, x+w-1, y+j, c); }
    }
    function drawShadow(ctx, cx, y){
      rect(ctx, cx-8, y,   16, 2, "rgba(0,0,0,.26)");
      rect(ctx, cx-6, y+2, 12, 2, "rgba(0,0,0,.18)");
      rect(ctx, cx-3, y+4,  6, 1, "rgba(0,0,0,.10)");
    }

    // ===== Cute chibi renderer =====
    function drawPerson(ctx, ox, oy, p, frame){
      const f = frame % 4;
      const step = (f === 1) ? -1 : (f === 3 ? 1 : 0);
      const bob  = (f === 1 || f === 3) ? 0 : 1;

      const cx = ox + 28;
      const headTop = oy + 6 + bob;

      // HEAD
      rect(ctx, cx-10, headTop+2, 20, 16, p.skin);
      rect(ctx, cx-9,  headTop+1, 18, 1,  p.skin);
      rect(ctx, cx-9,  headTop+18,18, 1,  p.skinShade);

      px(ctx, cx-9, headTop+14, p.skinShade);
      px(ctx, cx+8, headTop+14, p.skinShade);

      // HAIR
      rect(ctx, cx-11, headTop-2, 22, 6, p.hair);
      rect(ctx, cx-11, headTop+4,  4, 12, p.hair);
      rect(ctx, cx+7,  headTop+4,  4, 12, p.hair);

      rect(ctx, cx-10, headTop+6, 20, 3, p.hair2);
      px(ctx, cx-7, headTop+9, p.hair2);
      px(ctx, cx-3, headTop+9, p.hair2);
      px(ctx, cx+1, headTop+9, p.hair2);
      px(ctx, cx+5, headTop+9, p.hair2);

      if(p === BUNNY){
        rect(ctx, cx-13, headTop+12, 7, 12, p.hair);
        rect(ctx, cx+6,  headTop+12, 7, 12, p.hair);
        rect(ctx, cx-12, headTop+18, 5, 7,  p.hair2);
        rect(ctx, cx+7,  headTop+18, 5, 7,  p.hair2);
        px(ctx, cx-12, headTop+6, "rgba(57,255,136,.65)");
        px(ctx, cx-11, headTop+6, "rgba(255,255,255,.45)");
      } else {
        rect(ctx, cx-13, headTop+7, 2, 7, p.hair);
        rect(ctx, cx+11, headTop+7, 2, 7, p.hair);
      }

      // EYES (boy green now)
      rect(ctx, cx-8, headTop+11, 4, 5, p.eye);
      rect(ctx, cx+4, headTop+11, 4, 5, p.eye);
      rect(ctx, cx-8, headTop+15, 4, 1, p.eye2);
      rect(ctx, cx+4, headTop+15, 4, 1, p.eye2);

      // highlights
      px(ctx, cx-8, headTop+11, "rgba(255,255,255,.95)");
      px(ctx, cx+4, headTop+11, "rgba(255,255,255,.95)");
      px(ctx, cx-7, headTop+12, "rgba(255,255,255,.25)");
      px(ctx, cx+5, headTop+12, "rgba(255,255,255,.25)");

      // blush
      px(ctx, cx-10, headTop+16, p.blush);
      px(ctx, cx-9,  headTop+16, "rgba(255,143,176,.55)");
      px(ctx, cx+9,  headTop+16, p.blush);
      px(ctx, cx+8,  headTop+16, "rgba(255,143,176,.55)");

      // mouth
      rect(ctx, cx-1, headTop+17, 2, 2, "#2a1a16");
      px(ctx, cx, headTop+18, "#ff7da6");

      // glasses
      if(p.glasses){
        rect(ctx, cx-10, headTop+10, 9, 6, "rgba(170,210,255,.09)");
        rect(ctx, cx+1,  headTop+10, 9, 6, "rgba(170,210,255,.09)");
        outlineRect(ctx, cx-10, headTop+10, 9, 6, p.glasses);
        outlineRect(ctx, cx+1,  headTop+10, 9, 6, p.glasses);
        px(ctx, cx, headTop+13, p.glasses);
      }

      // BODY
      const bodyY = headTop + 20;
      rect(ctx, cx-8, bodyY, 16, 11, p.hoodie);
      rect(ctx, cx-8, bodyY, 16, 3,  p.hoodie2);
      rect(ctx, cx+4, bodyY+3, 4, 8, p.hoodieShade);

      if(p.accent){
        rect(ctx, cx-1, bodyY+5, 2, 2, p.accent);
        px(ctx, cx+1, bodyY+6, "rgba(0,0,0,.25)");
      }

      // arms
      const armY = bodyY + 3;
      rect(ctx, cx-11, armY + (step===-1?1:0), 3, 6, p.hoodie2);
      rect(ctx, cx+8,  armY + (step=== 1?1:0), 3, 6, p.hoodie2);
      rect(ctx, cx-11, armY+6 + (step===-1?1:0), 3, 3, p.skin);
      rect(ctx, cx+8,  armY+6 + (step=== 1?1:0), 3, 3, p.skinShade);

      // legs
      const legY = bodyY + 11;
      rect(ctx, cx-5 + (step===-1?-1:0), legY, 4, 7, p.pants);
      rect(ctx, cx+1 + (step=== 1? 1:0), legY, 4, 7, p.pants2);

      // shoes
      rect(ctx, cx-5 + (step===-1?-1:0), legY+7, 4, 2, p.shoe2);
      rect(ctx, cx+1 + (step=== 1? 1:0), legY+7, 4, 2, p.shoe2);
      rect(ctx, cx-5 + (step===-1?-1:0), legY+8, 4, 1, p.shoe);
      rect(ctx, cx+1 + (step=== 1? 1:0), legY+8, 4, 1, p.shoe);

      outlineRect(ctx, cx-10, headTop+1, 20, 18, p.outline);
      outlineRect(ctx, cx-8,  bodyY,     16, 11, p.outline);
    }

    // TRUE hand-hold + closer spacing
    function drawCouple(canvas, frame=0){
      const SHIFT = 18;              // closer than before
      const ctx = setupCanvas(canvas, 112 - SHIFT, 76);

      // centers
      const leftCenter  = 28;
      const rightCenter = 84 - SHIFT;

      drawShadow(ctx, leftCenter, 66);
      drawShadow(ctx, rightCenter, 66);

      drawPerson(ctx, 0, 0, YOU, frame);
      drawPerson(ctx, 56 - SHIFT, 0, BUNNY, frame);

      // Overdraw "reaching arms" so they clearly connect
      // Meeting point (center between them)
      const meetX = 56 - Math.floor(SHIFT/2);
      const meetY = 52;

      // left arm reaching right
      rect(ctx, meetX-10, meetY-1, 10, 3, YOU.hoodie2);
      rect(ctx, meetX-2,  meetY-1, 2, 3, YOU.skin);

      // right arm reaching left
      rect(ctx, meetX+2,  meetY-1, 10, 3, BUNNY.hoodie2);
      rect(ctx, meetX+2,  meetY-1, 2, 3, BUNNY.skinShade);

      // hands together (single ‚ÄúÊè°‚Äù block)
      rect(ctx, meetX, meetY-1, 4, 3, "rgba(231,196,167,.95)");
      px(ctx, meetX,   meetY-1, YOU.outline);
      px(ctx, meetX+3, meetY-1, YOU.outline);
      px(ctx, meetX,   meetY+1, YOU.outline);
      px(ctx, meetX+3, meetY+1, YOU.outline);

      // tiny heart sparkle sometimes
      if((frame % 8) === 1){
        px(ctx, meetX+1, 30, "rgba(255,111,169,.95)");
        px(ctx, meetX+2, 30, "rgba(255,155,196,.85)");
        px(ctx, meetX+1, 31, "rgba(255,155,196,.85)");
        px(ctx, meetX+2, 31, "rgba(255,111,169,.95)");
      }
    }

    function makeMarker(){
      const m = document.createElement("div");
      m.className = "marker idle";
      const c = document.createElement("canvas");
      c.className = "couple";
      m.appendChild(c);
      m._canvas = c;
      drawCouple(c, 0);
      return m;
    }

    function animateWalk(marker, duration = 720){
      if(!marker || !marker._canvas) return;
      marker.classList.remove("idle");
      const start = performance.now();

      function step(now){
        const t = now - start;
        const frame = Math.floor(t / 90) % 8;
        drawCouple(marker._canvas, frame);

        if(t < duration){
          requestAnimationFrame(step);
        } else {
          drawCouple(marker._canvas, 0);
          marker.classList.add("idle");
        }
      }
      requestAnimationFrame(step);
    }

    function normalize(){
      state.markerRow = Math.max(0, Math.min(state.rows.length-1, state.markerRow||0));
      for(const r of state.rows){
        if(typeof r.day !== "string") r.day = "";
        if(typeof r.task !== "string") r.task = "";
        r.done = !!r.done;
      }
    }

    function handleRowClick(targetIndex){
      const cur = state.markerRow;
      let didAdvance = false;

      if(targetIndex > cur){
        state.rows[cur].done = true;
        state.markerRow = targetIndex;
        didAdvance = true;
      } else {
        state.markerRow = targetIndex;
      }

      save();
      render({ animate: didAdvance });
    }

    // auto-resize textarea so "listing tasks" always shows
    function autosize(ta){
      ta.style.height = "0px";
      ta.style.height = Math.max(54, ta.scrollHeight) + "px";
    }

    function render(opts = {}){
      normalize();
      list.innerHTML = "";

      state.rows.forEach((r, ri)=>{
        const row = document.createElement("div");
        row.className = "row" + (r.done ? " done" : "");
        row.addEventListener("click", ()=> handleRowClick(ri));

        const day = document.createElement("input");
        day.className = "dayInput";
        day.type = "text";
        day.value = r.day || "";
        day.placeholder = "Day";
        day.addEventListener("click", (e)=> e.stopPropagation());
        day.addEventListener("input", ()=>{
          r.day = day.value;
          save();
        });

        // textarea FIX (so tasks actually display and edit correctly)
        const task = document.createElement("textarea");
        task.className = "task";
        task.value = r.task || "";
        task.placeholder = "type something sweet‚Ä¶";
        task.rows = 1;

        task.addEventListener("click", (e)=> e.stopPropagation());
        task.addEventListener("input", ()=>{
          r.task = task.value;
          autosize(task);
          save();
        });

        // allow Enter to create a new line, but Ctrl+Enter advances
        task.addEventListener("keydown",(e)=>{
          if(e.key==="Enter" && (e.ctrlKey || e.metaKey)){
            e.preventDefault();
            const next = Math.min(state.rows.length-1, ri+1);
            if(next !== ri){
              state.rows[ri].done = true;
              state.markerRow = next;
              save();
              render({ animate: true });
            }
          }
        });

        const right = document.createElement("div");
        if(ri === state.markerRow){
          const marker = makeMarker();
          marker.title = "We are here";
          marker.addEventListener("click", (e)=> e.stopPropagation());
          right.appendChild(marker);
        } else {
          right.innerHTML = "";
        }

        row.append(day, task, right);
        list.appendChild(row);

        // ensure correct size after insertion
        autosize(task);
      });

      if(opts.animate){
        const marker = document.querySelector(".marker");
        if(marker) animateWalk(marker);
      }
    }

    function addRow(){
      const idx = state.rows.length;
      const day = DAYS[idx % DAYS.length] || `Day ${idx+1}`;
      state.rows.push({ day, task:"", done:false });
      normalize();
      save();
      render();
    }

    addRowBtn.addEventListener("click", addRow);

    resetBtn.addEventListener("click", ()=>{
      if(!confirm("Reset everything?")) return;
      state = structuredClone(DEFAULT);
      save();
      render();
    });

    normalize();
    save();
    render();
  </script>
</body>
</html>